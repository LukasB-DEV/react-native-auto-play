on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  code-review:
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false
    permissions:
      pull-requests: write
      contents: read
    steps:
      - name: Delete previous review comments
        uses: samuelbrucksch/delete-comment@1.0.2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          delete_user_name: github-actions
          issue_number: ${{ github.event.pull_request.number }}
          body_regex: "*"
      - name: Azure OpenAI CodeReviewer
        uses: samuelbrucksch/ChatGPT-CodeReview@0.0.9
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          AZURE_OPENAI_API_KEY: ${{ secrets.AZURE_OPENAI_API_KEY }}
          AZURE_API_ENDPOINT: https://riv-openai-mobile-engineering-dev-swedencentral.openai.azure.com
          AZURE_OPENAI_DEPLOYMENT_NAME: mobile-eng-gpt-o3-mini-dev-sdc
          AZURE_OPENAI_API_VERSION: 2024-12-01-preview
          # Optional 
          AZURE_OPENAI_API_ASSISTANT_INSTRUCTION: "Please review the Pullrequest from the diff. Keep it short and do not summarize what changed, rather focus on things that can be improved if there are any."
